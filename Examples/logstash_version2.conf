input {
  syslog {
    port => 5514
    type => "syslog"
  }
}
filter {
  # Parse the basic syslog format first
  grok {
    match => {
      "message" => "<%{POSINT:priority}>%{INT:version} %{TIMESTAMP_ISO8601:timestamp} %{IPORHOST:host} %{WORD:application} %{GREEDYDATA:raw_message}"
    }
    add_tag => ["parsed_syslog"]
  }
 
  # Smart application detection
  if [application] == "OOTBI" {
    mutate { add_field => { "app_type" => "ootbi" } }
  }
  else if [application] =~ /(?i)veeam/ {
    mutate { add_field => { "app_type" => "veeam" } }
  }
  else {
    mutate { add_field => { "app_type" => "unknown" } }
  }

  # Ruby filter for additional processing
  ruby {
    code => "
      # Add your Ruby code here
      # Example: event.set('processed_timestamp', Time.now.to_i)
    "
  }
}
output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "raw-logs-%{+YYYY.MM.dd}"
  }
  # Useful for debugging
  stdout { codec => rubydebug }
}
